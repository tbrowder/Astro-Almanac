Moon illumination info in the Cal repository
============================================

Information extracted from file 'moon-illumination.raku':

Note the repo and the file have lots of Moon ifo and subroutines
for handling lunation.

# define which Moon illumination fraction we're talking about
enum Phase <Waxing Waning>;

The az/el horizontal coordinate system for astronautical use
------------------------------------------------------------

From Wikipedia:

Altitude (elevation) is the angle between the observer's horizon
and the celestial object. For visible objects it is between zero
and 90 degrees.

Azimuth is the angle of the object around the horizon, usually
messured from true north eastward.


##### SUBROUTINES #####
=begin comment
The Moon crescent angle, a, from Stack Overflow, is calculated as:

Given az,el in degrees of the Sun (saz, sel) and Moon (maz, mel), calculate a
where daz is the difference between the two azimuth angles:

  daz = saz - maz
  y = sin(deg2rad(daz)) * cos(deg2rad(sel))
  x = cos(deg2rad(mel)) * sin(deg2rad(mel))
  a = atan2(x,y)
  a = rad2deg(a)

The crescent angle, a, is the angle in degrees of the line from the Sun
to the Moon as seen in 2D from the Earth with 360 degrees
being "down" toward the "top" of the Moon as seen from the observer
on the Earth.

NOTE: I need to confirm this after seeing the images
produced with the formula.

Questions: 

1. How is the hemisphere of the observer handled?
2. Can we make an ASCII representation of the angles 
   and shapes involved?




=end comment

sub crescent-angle(:$saz!, :$sel!, :$maz!, :$mel!) {
    #my $daz = ($saz.abs - $maz.abs).abs;
    my $daz = $saz - $maz;
    my $y   = sin(deg2rad($daz)) * cos(deg2rad($sel));
    my $x   = cos(deg2rad($mel)) * sin(deg2rad($mel));
    my $ca  = atan2($x,$y);
    $ca     = rad2deg($ca);
}

sub get-phase-name($i, # the phase increment index
                   $f, # the fraction of illumination
                  ) {
    # the phases are minimally divided into five increments ($i: 0..4)
    # within each increment we calculate a title as appropriate
    if $i < 3 {
        # new moon waxing to full illumination
        given $f {
            when $f ==   0 { "new moon" }
            when $f <   50 { "waxing crescent" }
            when $f ==  50 { "first quarter" }
            when $f <  100 { "waxing gibbous" }
            when $f == 100 { "full moon" }
            default { die "FATAL: Unexpected fractional illumination factor: $f"; }
        }
    }
    else {
        # full moon waning to total darkness
        given $f {
            when $f ==   0 { "new moon" }
            when $f <   50 { "waxing crescent" }
            when $f ==  50 { "third quarter" }
            when $f <  100 { "waning gibbous" }
            default { die "FATAL: Unexpected fractional illumination factor: $f"; }
        }
    }
}
